<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ğŸ” Admin Â· LÃ¬ XÃ¬ Dashboard</title>
  <meta name="robots" content="noindex, nofollow" />
  <link rel="stylesheet" href="../admin.css" />
</head>
<body>

<!-- ===================== LOGIN SCREEN ===================== -->
<div id="login-screen">
  <div class="login-box">
    <span class="login-logo">ğŸ”</span>
    <h1 class="login-title">Admin Dashboard</h1>
    <p class="login-subtitle">LÃ¬ XÃ¬ Táº¿t Â· Quáº£n Trá»‹</p>

    <form id="login-form" novalidate>
      <div class="login-field">
        <label for="login-user">TÃªn Ä‘Äƒng nháº­p</label>
        <input
          type="text"
          id="login-user"
          placeholder="admin"
          autocomplete="username"
          required
        />
      </div>
      <div class="login-field">
        <label for="login-pass">Máº­t kháº©u</label>
        <input
          type="password"
          id="login-pass"
          placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
          autocomplete="current-password"
          required
        />
      </div>
      <p class="login-error" id="login-error" role="alert"></p>
      <button type="submit" class="login-btn">ğŸ”“ ÄÄƒng Nháº­p</button>
    </form>

    <p class="login-back">
      â† <a href="/">Quay vá» trang chÆ¡i</a>
    </p>
  </div>
</div>

<!-- ===================== ADMIN APP ===================== -->
<div id="admin-app">

  <!-- SIDEBAR -->
  <aside class="sidebar" id="sidebar" role="navigation" aria-label="Admin navigation">
    <div class="sidebar-logo">
      <span class="logo-icon">ğŸ§§</span>
      <div>
        <div class="logo-text">LÃ¬ XÃ¬ Admin</div>
        <div class="logo-sub">Táº¿t 2025</div>
      </div>
    </div>

    <nav class="sidebar-nav">
      <div class="nav-section">
        <div class="nav-section-label">Tá»•ng quan</div>
        <button class="nav-link active" data-tab="overview">
          <span class="nav-icon">ğŸ“Š</span>
          <span class="nav-label">Dashboard</span>
        </button>
        <button class="nav-link" data-tab="envelopes">
          <span class="nav-icon">ğŸ§§</span>
          <span class="nav-label">Phong bÃ¬</span>
          <span class="nav-badge" id="badge-special">2</span>
        </button>
      </div>

      <div class="nav-section">
        <div class="nav-section-label">PhÃ¢n tÃ­ch</div>
        <button class="nav-link" data-tab="analytics">
          <span class="nav-icon">ğŸ“ˆ</span>
          <span class="nav-label">Thá»‘ng kÃª</span>
        </button>
        <button class="nav-link" data-tab="special">
          <span class="nav-icon">â­</span>
          <span class="nav-label">Ã” Ä‘áº·c biá»‡t</span>
        </button>
      </div>

      <div class="nav-section">
        <div class="nav-section-label">Há»‡ thá»‘ng</div>
        <button class="nav-link" data-tab="settings">
          <span class="nav-icon">âš™ï¸</span>
          <span class="nav-label">CÃ i Ä‘áº·t</span>
        </button>
      </div>
    </nav>

    <div class="sidebar-footer">
      <div class="sidebar-user">
        <div class="user-avatar">A</div>
        <div>
          <div class="user-name">Admin</div>
          <div class="user-role">Quáº£n trá»‹ viÃªn</div>
        </div>
        <button class="logout-btn" id="logout-btn" title="ÄÄƒng xuáº¥t" aria-label="ÄÄƒng xuáº¥t">â»</button>
      </div>
    </div>
  </aside>

  <!-- MAIN CONTENT -->
  <main class="main-content">

    <!-- TOP BAR -->
    <div class="top-bar">
      <h2 class="top-bar-title" id="top-bar-title">Dashboard</h2>
      <div class="top-bar-actions">
        <span class="top-badge">ğŸ”’ ADMIN</span>
        <button class="icon-btn" id="refresh-btn" title="LÃ m má»›i" aria-label="LÃ m má»›i dá»¯ liá»‡u">â†º</button>
        <button class="icon-btn" id="export-btn" title="Xuáº¥t CSV" aria-label="Xuáº¥t dá»¯ liá»‡u CSV">ğŸ“¥</button>
        <a class="icon-btn" id="goto-main-btn" href="/" title="Trang chÃ­nh" aria-label="Vá» trang chÃ­nh">ğŸ </a>
      </div>
    </div>

    <!-- CONTENT AREA -->
    <div class="content-area">

      <!-- ===== TAB: OVERVIEW ===== -->
      <section class="tab-section active" id="tab-overview">

        <!-- Metrics Row 1 -->
        <div class="metrics-grid">
          <div class="metric-card gold">
            <span class="metric-icon">ğŸ§§</span>
            <div class="metric-value" id="m-total">20</div>
            <div class="metric-label">Tá»•ng sá»‘ Ã´</div>
            <span class="metric-sub">Cá»‘ Ä‘á»‹nh</span>
          </div>
          <div class="metric-card green">
            <span class="metric-icon">âœ…</span>
            <div class="metric-value" id="m-opened">0</div>
            <div class="metric-label">ÄÃ£ má»Ÿ</div>
          </div>
          <div class="metric-card blue">
            <span class="metric-icon">â³</span>
            <div class="metric-value" id="m-pending">20</div>
            <div class="metric-label">ChÆ°a má»Ÿ</div>
          </div>
          <div class="metric-card red">
            <span class="metric-icon">â­</span>
            <div class="metric-value" id="m-special-opened">0/2</div>
            <div class="metric-label">Ã” Ä‘áº·c biá»‡t má»Ÿ</div>
          </div>
        </div>

        <!-- Metrics Row 2 -->
        <div class="metrics-grid" style="margin-bottom:28px">
          <div class="metric-card purple">
            <span class="metric-icon">ğŸ’µ</span>
            <div class="metric-value" id="m-display-total">0k</div>
            <div class="metric-label">Tá»•ng hiá»ƒn thá»‹ (Ä‘Ã£ má»Ÿ)</div>
          </div>
          <div class="metric-card gold">
            <span class="metric-icon">ğŸ’°</span>
            <div class="metric-value" id="m-real-total">0k</div>
            <div class="metric-label">Tá»•ng thá»±c (Ä‘Ã£ má»Ÿ)</div>
          </div>
          <div class="metric-card blue">
            <span class="metric-icon">ğŸ“Š</span>
            <div class="metric-value" id="m-progress-pct">0%</div>
            <div class="metric-label">Tiáº¿n Ä‘á»™ bá»‘c</div>
          </div>
        </div>

        <!-- Chart section -->
        <div class="chart-section">
          <div class="chart-card">
            <div class="chart-card-title">ğŸ“Š PhÃ¢n phá»‘i má»‡nh giÃ¡ thá»±c</div>
            <div id="chart-distribution"></div>
          </div>
          <div class="chart-card">
            <div class="chart-card-title">ğŸ¯ Tá»‰ lá»‡ má»Ÿ</div>
            <div id="chart-open-rate"></div>
          </div>
        </div>

      </section>

      <!-- ===== TAB: ENVELOPES ===== -->
      <section class="tab-section" id="tab-envelopes">
        <div class="table-section">
          <div class="table-header">
            <div class="table-title">
              <span class="t-icon">ğŸ§§</span>
              Danh sÃ¡ch phong bÃ¬
            </div>
            <div class="table-controls">
              <input
                type="search"
                class="search-input"
                id="env-search"
                placeholder="TÃ¬m kiáº¿m..."
                aria-label="TÃ¬m kiáº¿m phong bÃ¬"
              />
              <select class="filter-select" id="env-filter" aria-label="Lá»c theo tráº¡ng thÃ¡i">
                <option value="all">Táº¥t cáº£</option>
                <option value="opened">ÄÃ£ má»Ÿ</option>
                <option value="pending">ChÆ°a má»Ÿ</option>
                <option value="special">Äáº·c biá»‡t</option>
              </select>
            </div>
          </div>
          <table class="data-table" role="table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Loáº¡i</th>
                <th>Hiá»ƒn thá»‹</th>
                <th>Má»‡nh giÃ¡ thá»±c</th>
                <th>Tráº¡ng thÃ¡i</th>
                <th>Thá»i gian</th>
                <th>Thao tÃ¡c</th>
              </tr>
            </thead>
            <tbody id="env-tbody">
              <!-- Rendered by admin.js -->
            </tbody>
          </table>
        </div>
      </section>

      <!-- ===== TAB: ANALYTICS ===== -->
      <section class="tab-section" id="tab-analytics">
        <div class="chart-section">
          <div class="chart-card">
            <div class="chart-card-title">ğŸ“Š Chi tiáº¿t phÃ¢n phá»‘i má»‡nh giÃ¡</div>
            <div id="chart-distribution-2"></div>
          </div>
          <div class="chart-card">
            <div class="chart-card-title">ğŸ¯ Tá»‰ lá»‡ má»Ÿ chi tiáº¿t</div>
            <div id="chart-open-rate-2"></div>
          </div>
        </div>

        <div class="table-section">
          <div class="table-header">
            <div class="table-title">
              <span class="t-icon">ğŸ“‹</span>
              Lá»‹ch sá»­ bá»‘c (thá»© tá»± thá»i gian)
            </div>
          </div>
          <table class="data-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Má»‡nh giÃ¡ thá»±c</th>
                <th>Thá»i gian má»Ÿ</th>
                <th>Loáº¡i</th>
              </tr>
            </thead>
            <tbody id="history-tbody">
              <!-- Rendered dynamically -->
            </tbody>
          </table>
        </div>
      </section>

      <!-- ===== TAB: SPECIAL ===== -->
      <section class="tab-section" id="tab-special">
        <div class="special-highlight">
          <div class="special-highlight-title">
            â­ Ã” Äáº·c Biá»‡t (Má»‡nh giÃ¡ áº©n: 50k &amp; 100k)
          </div>
          <p style="font-size:0.85rem;color:var(--text-secondary);margin-bottom:20px">
            Nhá»¯ng Ã´ nÃ y hiá»ƒn thá»‹ má»‡nh giÃ¡ 1â€“20k vá»›i ngÆ°á»i chÆ¡i, nhÆ°ng giÃ¡ trá»‹ thá»±c cao hÆ¡n.
            Khi má»Ÿ, ngÆ°á»i chÆ¡i sáº½ Ä‘Æ°á»£c hÆ°á»›ng dáº«n Ä‘áº¿n trang admin nÃ y.
          </p>
          <div class="special-cards-grid" id="special-cards">
            <!-- Rendered by admin.js -->
          </div>
        </div>

        <div class="chart-card">
          <div class="chart-card-title">â„¹ï¸ CÆ¡ cháº¿ hoáº¡t Ä‘á»™ng</div>
          <div style="font-size:0.88rem;color:var(--text-secondary);line-height:1.8">
            <p style="margin-bottom:10px">
              ğŸ”¸ <strong style="color:var(--text-primary)">Má»‡nh giÃ¡ hiá»ƒn thá»‹:</strong>
              NgÆ°á»i chÆ¡i tháº¥y má»‡nh giÃ¡ 1k â€“ 20k ngáº«u nhiÃªn khi bá»‘c.
            </p>
            <p style="margin-bottom:10px">
              ğŸ”¸ <strong style="color:var(--text-primary)">Má»‡nh giÃ¡ thá»±c:</strong>
              2 Ã´ Ä‘áº·c biá»‡t cÃ³ giÃ¡ trá»‹ thá»±c lÃ  50k vÃ  100k â€” chá»‰ admin biáº¿t vá»‹ trÃ­.
            </p>
            <p style="margin-bottom:10px">
              ğŸ”¸ <strong style="color:var(--text-primary)">Khi má»Ÿ Ã´ Ä‘áº·c biá»‡t:</strong>
              Há»‡ thá»‘ng hiá»ƒn thá»‹ má»‡nh giÃ¡ bÃ¬nh thÆ°á»ng cho ngÆ°á»i chÆ¡i, sau Ä‘Ã³ gá»£i Ã½ truy cáº­p <code style="color:var(--gold)">/admin</code> Ä‘á»ƒ biáº¿t má»‡nh giÃ¡ thá»±c.
            </p>
            <p>
              ğŸ”¸ <strong style="color:var(--text-primary)">Báº£o máº­t:</strong>
              Trang admin yÃªu cáº§u Ä‘Äƒng nháº­p Ä‘á»ƒ xem thÃ´ng tin má»‡nh giÃ¡ áº©n.
            </p>
          </div>
        </div>
      </section>

      <!-- ===== TAB: SETTINGS ===== -->
      <section class="tab-section" id="tab-settings">
        <div class="settings-grid">

          <div class="settings-card">
            <div class="settings-card-title">âš™ï¸ Cáº¥u hÃ¬nh game</div>
            <div class="setting-row">
              <span class="setting-label">Tá»•ng sá»‘ Ã´</span>
              <span class="setting-value" id="cfg-total">20</span>
            </div>
            <div class="setting-row">
              <span class="setting-label">Sá»‘ Ã´ Ä‘áº·c biá»‡t</span>
              <span class="setting-value" id="cfg-special">2</span>
            </div>
            <div class="setting-row">
              <span class="setting-label">Má»‡nh giÃ¡ hiá»ƒn thá»‹ tá»‘i thiá»ƒu</span>
              <span class="setting-value" id="cfg-min">1k</span>
            </div>
            <div class="setting-row">
              <span class="setting-label">Má»‡nh giÃ¡ hiá»ƒn thá»‹ tá»‘i Ä‘a</span>
              <span class="setting-value" id="cfg-max">20k</span>
            </div>
            <div class="setting-row">
              <span class="setting-label">Má»‡nh giÃ¡ áº©n (Ä‘áº·c biá»‡t)</span>
              <span class="setting-value" id="cfg-hidden">50k, 100k</span>
            </div>
          </div>

          <div class="settings-card">
            <div class="settings-card-title">ğŸ›  Thao tÃ¡c</div>
            <button class="action-btn action-btn-red" id="reset-game-btn">
              ğŸ”„ Äáº·t láº¡i toÃ n bá»™ game
            </button>
            <button class="action-btn action-btn-gold" id="export-btn-2" onclick="document.getElementById('export-btn').click()">
              ğŸ“¥ Xuáº¥t dá»¯ liá»‡u CSV
            </button>
            <button class="action-btn action-btn-blue" onclick="window.open('/','_blank')">
              ğŸ§§ Má»Ÿ trang ngÆ°á»i chÆ¡i
            </button>
          </div>

          <div class="settings-card">
            <div class="settings-card-title">ğŸ” Báº£o máº­t</div>
            <div class="setting-row">
              <span class="setting-label">PhiÃªn Ä‘Äƒng nháº­p</span>
              <span class="setting-value">SessionStorage</span>
            </div>
            <div class="setting-row">
              <span class="setting-label">LÆ°u trá»¯ dá»¯ liá»‡u</span>
              <span class="setting-value">localStorage</span>
            </div>
            <div class="setting-row">
              <span class="setting-label">Route admin</span>
              <span class="setting-value">/admin</span>
            </div>
            <button class="action-btn action-btn-red" id="logout-btn-2" onclick="document.getElementById('logout-btn').click()">
              â» ÄÄƒng xuáº¥t
            </button>
          </div>

        </div>
      </section>

    </div><!-- /content-area -->
  </main>

</div><!-- /admin-app -->

<!-- TOAST NOTIFICATION -->
<div class="toast" id="toast" role="status" aria-live="polite"></div>

<script>
  // Render history tab when it becomes active
  document.addEventListener('click', (e) => {
    if (e.target.dataset.tab === 'analytics') {
      setTimeout(renderHistoryTab, 100);
    }
  });

  function renderHistoryTab() {
    if (!window.gameData) return;
    const tbody = document.getElementById('history-tbody');
    if (!tbody) return;

    const opened = window.gameData
      .filter(e => e.opened && e.openedAt)
      .sort((a, b) => new Date(a.openedAt) - new Date(b.openedAt));

    tbody.innerHTML = opened.map(e => `
      <tr>
        <td style="font-family:'JetBrains Mono',monospace;color:var(--text-primary)">#${String(e.id).padStart(2,'0')}</td>
        <td style="font-family:'JetBrains Mono',monospace;font-size:1.05rem;color:${e.isSpecial?'var(--gold-shine)':'var(--text-primary)'}">
          ${e.realValue}k ${e.isSpecial?'â­':''}
        </td>
        <td style="font-size:0.82rem;color:var(--text-muted)">${new Date(e.openedAt).toLocaleString('vi-VN')}</td>
        <td><span class="badge ${e.isSpecial?'badge-special':'badge-normal'}">${e.isSpecial?'ğŸ”¥ Äáº·c biá»‡t':'ğŸ“¦ ThÆ°á»ng'}</span></td>
      </tr>
    `).join('');

    if (opened.length === 0) {
      tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;color:var(--text-muted);padding:30px">ChÆ°a cÃ³ Ã´ nÃ o Ä‘Æ°á»£c má»Ÿ</td></tr>';
    }
  }
</script>

<script src="../admin.js"></script>
</body>
</html>
